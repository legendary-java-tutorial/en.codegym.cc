<h2>1. Rounding real numbers</h2>
<p>As we have already discussed, when a real number is assigned to an <code>int</code> variable, it is always rounded down to the nearest smaller integer — the fractional part is simply discarded.</p>
<p>But it's easy to imagine a situation when a fractional number needs to be rounded to the nearest integer in either direction or even rounded up. What do you do in this case?</p>
<p>For this and for many similar situations, Java has the <code>Math</code> class, which has the <code>round()</code>, <code>ceil()</code>, and <code>floor()</code> methods.</p>
<hr>
<p><strong><code>Math.round()</code> method</strong></p>
<p>The <code>Math.round()</code> method rounds a number to the nearest integer:</p>
<div class="lesson-example lesson-example--center">
    <pre class="lecture-code lecture-code--present language-java"><code>long <span class="code text-green">x</span> = Math.round(<span class="code text-user">real_number</span>)</code></pre>
</div>
<p>But there's another nuance here: this method returns a <code>long</code> integer (not an <code>int</code>). Because real numbers can be very large, Java's creators decided to use Java's largest available integer type: <code>long</code>.</p>
<p>Accordingly, if a programmer wants to assign the result to an <code>int</code> variable, then she must explicitly indicate to the compiler that she accepts the possible loss of data (in the event that the resulting number does not fit into an <code>int</code> type).</p>
<div class="lesson-example lesson-example--center">
    <pre class="lecture-code lecture-code--present language-java"><code>int <span class="code text-green">x</span> = <span class="text-red">(int)</span> Math.round(<span class="code text-user">real_number</span>)</code></pre>
</div>
<p>Examples:</p>
<table>
    <tbody>
    <tr>
        <th width="70%">Statement</th>
        <th class="text-center">Result</th>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>int <span class="code text-green">x</span> = <span class="text-red">(int)</span> Math.round(<span class="code text-user">4.1</span>);</code></pre>
        </td>
        <td>
            <pre class="text-center"><code>4</code></pre>
        </td>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>int <span class="code text-green">x</span> = <span class="text-red">(int)</span> Math.round(<span class="code text-user">4.5</span>);</code></pre>
        </td>
        <td>
            <pre class="text-center"><code>5</code></pre>
        </td>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>int <span class="code text-green">x</span> = <span class="text-red">(int)</span> Math.round(<span class="code text-user">4.9</span>);</code></pre>
        </td>
        <td>
            <pre class="text-center"><code>5</code></pre>
        </td>
    </tr>
    </tbody>
</table>
<p><strong><code>Math.ceil()</code> method</strong></p>
<p>The <code>Math.ceil()</code> method rounds a number <span class="text-bold">up</span> to an integer. Here are examples:</p>
<table>
    <tbody>
    <tr>
        <th width="70%">Statement</th>
        <th class="text-center">Result</th>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>int <span class="code text-green">x</span> = <span class="text-red">(int)</span> Math.ceil(<span class="code text-user">4.1</span>);</code></pre>
        </td>
        <td>
            <pre class="text-center"><code>5</code></pre>
        </td>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>int <span class="code text-green">x</span> = <span class="text-red">(int)</span> Math.ceil(<span class="code text-user">4.5</span>);</code></pre>
        </td>
        <td>
            <pre class="text-center"><code>5</code></pre>
        </td>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>int <span class="code text-green">x</span> = <span class="text-red">(int)</span> Math.ceil(<span class="code text-user">4.9</span>);</code></pre>
        </td>
        <td>
            <pre class="text-center"><code>5</code></pre>
        </td>
    </tr>
    </tbody>
</table>
<p><strong><code>Math.floor()</code> method</strong></p>
<p>The <code>Math.floor()</code> method rounds a number <span class="text-bold">down</span> to an integer. Here are examples:</p>
<table>
    <tbody>
    <tr>
        <th width="70%">Statement</th>
        <th class="text-center">Result</th>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>int <span class="code text-green">x</span> = <span class="text-red">(int)</span> Math.floor(<span class="code text-user">4.1</span>);</code></pre>
        </td>
        <td>
            <pre class="text-center"><code>4</code></pre>
        </td>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>int <span class="code text-green">x</span> = <span class="text-red">(int)</span> Math.floor(<span class="code text-user">4.5</span>);</code></pre>
        </td>
        <td>
            <pre class="text-center"><code>4</code></pre>
        </td>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>int <span class="code text-green">x</span> = <span class="text-red">(int)</span> Math.floor(<span class="code text-user">4.9</span>);</code></pre>
        </td>
        <td>
            <pre class="text-center"><code>4</code></pre>
        </td>
    </tr>
    </tbody>
</table>
<p>Of course, when rounding a number <span class="text-bold">down</span> to an integer, it's easier to simply use a type cast operator: <code>(int)</code></p>
<table>
    <tbody>
    <tr>
        <th width="70%">Statement</th>
        <th class="text-center">Result</th>
    </tr>
    <tr>
        <td>
            <pre class="language-java"><code>int <span class="code text-green">x</span> = <span class="text-red">(int)</span> <span class="code text-user">4.9</span></code></pre>
        </td>
        <td>
            <pre class="text-center"><code>4</code></pre>
        </td>
    </tr>
    </tbody>
</table>
<p>If you find it difficult to remember these names, a short English lesson will help:</p>
<ul>
    <li><code>Math</code> means mathematics</li>
    <li><code>Round</code> means round</li>
    <li><code>Ceiling</code> means ceiling</li>
    <li><code>Floor</code> means floor</li>
</ul>
<hr>
<div class="task-widget-container" showCover="true" taskKey="en.codegym.task.pro.task04.task0417"></div>
<div class="task-widget-container" showCover="true" taskKey="en.codegym.task.pro.task04.task0418"></div>
<h2>2. How floating-point numbers are structured</h2>
<p>The <code>double</code> type can store values in the range from <code>-1.7*10<sup class="text-user">308</sup></code> to <code>+1.7*10<sup class="text-user">308</sup></code>. This huge range of values (compared with the <code>int</code> type) is explained by the fact that the <code>double</code> type (as well as <code>float</code>) has a completely different internal structure than integer types. Internally, the <code>double</code> type encodes its value as two numbers: the first is called the <span class="term"><span class="text-red">mantissa</span></span>, and the second is called the <span class="term"><span class="text-user">exponent</span></span>.</p>
<p>Let's say we have the number <code>123456789</code> and store it a <code>double</code> variable. When we do, the number is converted to <code>1.<span class="text-red">23456789</span>*10<sup class="text-user">8</sup></code>, and internally the <code>double</code> type stores two numbers — <code><span class="text-red">23456789</span></code> and <code><span class="text-user">8</span></code>. The significand ("significant part of the number" or mantissa) is highlighted in red, while the exponent is highlighted in blue.</p>
<p>This approach makes it possible to store both very large numbers and very small ones. But because the number's representation is limited to 8 bytes (64 bits) and some of the bits are used to store the <span class="term"><span class="text-user">exponent</span></span> (as well as the sign of the mantissa and the sign of the exponent), the maximum digits available to represent the <span class="term"><span class="text-red">mantissa</span></span> is <span class="text-bold">15</span>.</p>
<p>This is a very <span class="text-bold">simplified</span> description of how real numbers are structured.</p>
<hr>
<h2>3. Loss of precision when working with real numbers</h2>
<p>When working with real numbers, always keep in mind that <span class="term text-user">real numbers</span> <span class="text-bold">are not exact</span>. There may always be <span class="term text-red">rounding errors</span> and <span class="term text-red">conversion errors</span> when converting from decimal to binary. Additionally, the most common source of error is <span class="term text-red">loss of precision</span> when adding/subtracting numbers on radically different scales.</p>
<p>This last fact is a little mind-blowing for novice programmers.</p>
<p>If we subtract <code>1/10<sup>9</sup></code> from <code>10<sup>9</sup></code>, we get <code>10<sup>9</sup></code>.</p>
<table>
    <tbody>
    <tr>
        <th>Subtracting numbers on radically different scales</th>
        <th>Explanation</th>
    </tr>
    <tr>
        <td>
<pre class="language-java"><code class="text-right"> 1<span class="text-orange">000000000</span>.<span class="text-orange">000000</span>000;
<sup>-</sup>         0.000000<span class="text-gray">001</span>;
 1<span class="text-orange">000000000</span>.<span class="text-orange">000000</span>000;</code></pre>
        </td>
        <td>The second number is <span class="text-bold">extremely small</span>, which will cause its significand (highlighted in gray) is be ignored. The <span class="text-orange">15 significant digits</span> are highlighted in orange.</td>
    </tr>
    </tbody>
</table>
<p>What can we say, programming isn't the same as mathematics.</p>
<hr>
<h2>4. Pitfall when comparing real numbers</h2>
<p>Another danger lies in wait for programmers when they compare real numbers. It arises when working with real numbers, because round-off errors can accumulate. The result is that there are situations when real numbers are expected to be equal, but they are not. Or vice versa: the numbers are expected to be different, but they are equal.</p>
<p>Example:</p>
<table>
    <tbody>
    <tr>
        <th width="47%">Statement</th>
        <th>Explanation</th>
    </tr>
    <tr>
        <td>
<pre class="language-java"><code><span>double</span> <span class="code text-green">a</span> = <span class="code text-user">1000000000.0</span>;
<span>double</span> <span class="code text-green">b</span> = <span class="code text-user">0.000000001</span>;
<span>double</span> <span class="code text-green">c</span> = <span class="code text-green">a</span> - <span class="code text-green">b</span>;</code></pre>
        </td>
        <td>
            The value of the variable <code class="text-green">a</code>&nbsp;will be <code>1000000000.0</code><br>
            The value of the variable <code class="text-green">c</code>&nbsp;will be <code>1000000000.0</code><br>
            (the number in the <code class="text-green">b</code>&nbsp;variable is excessively small)
        </td>
    </tr>
    </tbody>
</table>
<p>In the above example, <code class="text-green">a</code> and <code class="text-green">c</code> should not be equal, but they are.</p>
<p>Or let's take another example:</p>
<table>
    <tbody>
    <tr>
        <th width="47%">Statement</th>
        <th>Explanation</th>
    </tr>
    <tr>
        <td>
<pre class="language-java"><code><span>double</span> <span class="code text-green">a</span> = 1.<span class="text-orange">000000000000000</span><span class="text-gray">01</span>;
<span>double</span> <span class="code text-green">b</span> = 1.<span class="text-orange">000000000000000</span><span class="text-gray">02</span>;</code></pre>
        </td>
        <td>
            The value of the variable <code class="text-green">a</code>&nbsp;will be <code>1.0</code><br>
            The value of the variable <code class="text-green">b</code>&nbsp;will be <code>1.0</code>
        </td>
    </tr>
    </tbody>
</table>
<hr>
<h2 id="strictfp-story">5. An interesting fact about <code>strictfp</code></h2>
<p>Java has a special <code>strictfp</code> keyword (<span class="term"><strong>strict</strong> <strong>f</strong>loating <strong>p</strong>oint</span>), which is not found in other programming languages. And do you know why you need it? It <span class="text-red">worsens</span> the accuracy of operations with floating-point numbers. Here's the story of how it came to be:</p>
<div class="lesson-speech-bubble lesson-speech-bubble--left">
    <div class="lesson-speech-bubble__container">
        <div class="lesson-speech-bubble__name">Java's creators:</div>
        <div class="lesson-speech-bubble__message">
            We really want Java to be super popular and to run Java programs on as many devices as possible. So we made sure that the specification for the Java machine says that all programs must run <strong>the same way</strong> on all types of devices!
        </div>
    </div>
</div>

<div class="lesson-speech-bubble lesson-speech-bubble--right">
    <div class="lesson-speech-bubble__container">
        <div class="lesson-speech-bubble__name">Makers of Intel processors:</div>
        <div class="lesson-speech-bubble__message">
            Hey, everyone! We have improved our processors, and now all real numbers are represented using 10-bytes instead of 8-bytes inside our processors. More bytes means more significant digits. What does that mean? That's right! Now your scientific calculations will be even more accurate!
        </div>
    </div>
</div>

<div class="lesson-speech-bubble lesson-speech-bubble--right">
    <div class="lesson-speech-bubble__container">
        <div class="lesson-speech-bubble__name">Scientists and everyone involved in ultra-precise calculations:</div>
        <div class="lesson-speech-bubble__message">
            Cool! Well done. Excellent news!
        </div>
    </div>
</div>

<div class="lesson-speech-bubble lesson-speech-bubble--left">
    <div class="lesson-speech-bubble__container">
        <div class="lesson-speech-bubble__name">Java's creators:</div>
        <div class="lesson-speech-bubble__message">
            No-no-no, you guys! We already told you that all Java programs must run <strong>the same on all devices</strong>. We're going to forcibly disable the ability to use 10-byte real numbers inside Intel processors.
        </div>
    </div>
</div>

<div class="lesson-speech-bubble lesson-speech-bubble--left">
    <div class="lesson-speech-bubble__container">
        <div class="lesson-speech-bubble__message">
            Now everything is fine again! Don't thank us.
        </div>
    </div>
</div>

<div class="lesson-speech-bubble lesson-speech-bubble--right">
    <div class="lesson-speech-bubble__container">
        <div class="lesson-speech-bubble__name">Scientists and everyone involved in ultra-precise calculations:</div>
        <div class="lesson-speech-bubble__message">
            Have you gone entirely insane? Quickly get everything back as it was!
        </div>
    </div>
</div>

<div class="lesson-speech-bubble lesson-speech-bubble--left">
    <div class="lesson-speech-bubble__container">
        <div class="lesson-speech-bubble__name">Java's creators:</div>
        <div class="lesson-speech-bubble__message">
            Guys, this is for your own good! Just imagine: all Java programs run <strong>the same way on all devices</strong>. That's so cool!
        </div>
    </div>
</div>

<div class="lesson-speech-bubble lesson-speech-bubble--right">
    <div class="lesson-speech-bubble__container">
        <div class="lesson-speech-bubble__name">Scientists and everyone involved in ultra-precise calculations:</div>
        <div class="lesson-speech-bubble__message">
            No. It's not cool at all. Quickly put everything back how it was! Or do know where we'll put your Java?
        </div>
    </div>
</div>

<div class="lesson-speech-bubble lesson-speech-bubble--left">
    <div class="lesson-speech-bubble__container">
        <div class="lesson-speech-bubble__name">Java's creators:</div>
        <div class="lesson-speech-bubble__message">
            Hmm. Why didn't you say so right away? Of course, we'll put it back.
        </div>
    </div>
</div>

<div class="lesson-speech-bubble lesson-speech-bubble--left">
    <div class="lesson-speech-bubble__container">
        <div class="lesson-speech-bubble__message">
            We restored your ability to use all the features of the latest processors.
        </div>
    </div>
</div>

<div class="lesson-speech-bubble lesson-speech-bubble--left">
    <div class="lesson-speech-bubble__container">
        <div class="lesson-speech-bubble__message">
            By the way... We also specially added the <code>strictfp</code> keyword to the language. If you write it before the name of a function, then all the operations involving real numbers inside that function will be <span class="text-red">equally bad on all devices</span>!
        </div>
    </div>
</div>