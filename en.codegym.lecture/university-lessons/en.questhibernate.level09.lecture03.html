Working with Entity Objects
<p>----------------------------------------</p>
Transactions and Database Integrity Retrieving Objects Saving (Adding) Objects Deleting Objects
<p>----------------------------------------</p>
2>
<p>The normal mode of operation of a database is when it receives thousands of requests every minute from hundreds of different clients. In this case, situations often arise when the same data is accessed from different queries.</p>
<p>Less often, but, again, from time to time there are situations when one request reads a certain line, and another request changes it at the same time. Imagine what happens if someone reads a line that is only half changed? Nothing good.</p>
<p>This problem is solved in several ways. First, you can just lock the line that changes. Both for reading and for writing. This method works, but the speed of the base suffers greatly.</p>
<p>The second way is to lock the string for writing only. However, there will still be a problem when someone tries to read the partially modified line. Conclusion - there should not be a situation when the line is partially changed.</p>
<p>Therefore, they came up with a third method - transactions. A transaction is a group of actions that are performed either all together, or none at all. There cannot be a situation where part of the actions were performed, and the second part was not. If it is not possible to make all the changes, then all the changes already made are rolled back.</p>
<p>Any modern SQL server allows you to change data only in transactions. You open a transaction, make any changes to any number of tables, and commit the transaction. SQL Server then tries to make changes. If everything is just fine, then they will be added to the general database. If there were problems, then all changes will be canceled.</p>
<p>Hibernate also uses this paradigm. That is why in the previous lecture we saw that when trying to save the Employee object to the database, a transaction was first opened, and after saving, it was committed.</p>
<p>We will go into this topic in more detail, but for now, just know why transactions are needed and where they are usually used.</p>
<h2>4.2 Getting objects</h2>
<p>If Hibernate executes a request to get data, then there is no need to explicitly open a transaction. Hibernate itself will do this if it sees fit: it has its settings, as well as the settings of the SQL server.</p>
<p>We will analyze how to work with the database. And the simplest of them is getting an object by its <strong>ID</strong> . To do this, use the method <code>get()</code>on the <strong>session</strong> object . The general form of such a request:</p>
<div class="lesson-example lesson-example--center">
 <pre class="lecture-code lecture-code--present  language-java" tabindex="0"><code class=" language-java"><span class="text-brown">Class</span> Name <span class="token operator">=</span> <span class="text-user">session</span><span class="token punctuation">.</span><span class="token function"><span class="text-red">get</span></span><span class="token punctuation">(</span><span class="text-brown">Class</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="text-green">ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<p>Example:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword"></span><span class="text-brown"><span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span></span><span class="token punctuation"></span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Session</span> <span class="text-user">session</span> <span class="token operator">=</span> sessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="text-user">session</span><span class="token punctuation">.</span><span class="token function"><span class="text-red">get</span></span><span class="token punctuation">(</span><span class="token class-name"></span><span class="text-brown"><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span></span><span class="token keyword"></span><span class="token punctuation">,</span> <span class="text-green">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="text-viola">user</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2>4.3 Saving (adding) objects</h2>
<p>If you want to save your object to the database, then a query will be executed at the SQL level<mark class="green">INSERT</mark>. Therefore, your actions must be performed as a separate transaction. Also, it's better to use the <strong>session</strong><code>persist()</code> object's method for persistence .<strong></strong></p>
<p>The general form of such a request:</p>
<div class="lesson-example lesson-example--center">
 <pre class="lecture-code lecture-code--present  language-java" tabindex="0"><code class=" language-java"><span class="text-user">session</span><span class="token punctuation">.</span><span class="token function"><span class="text-red">persist</span></span><span class="token punctuation">(</span><span class="text-brown">An object</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<p>The method <code>persist()</code>changes not only the base, but also the object itself. The thing is that when we add an object to the database, this object does not yet have its own <strong>ID</strong> before adding it . Well, usually so, although there are nuances. And after adding the object already has <strong>an ID</strong> .</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword"></span><span class="text-brown"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">saveUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span></span><span class="token punctuation"></span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Session</span> <span class="text-user">session</span> <span class="token operator">=</span> sessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Transaction</span> transaction <span class="token operator">=</span> <span class="text-user">session</span><span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="text-user">session</span><span class="token punctuation">.</span><span class="token function"><span class="text-red">persist</span></span><span class="token punctuation">(</span><span class="text-brown">user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="text-viola">transaction</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><strong>The Session</strong> object also has a method <code>save()</code>that performs a similar function. It's just that the method <code>save()</code>is the old Hibernate standard and the method <code>persist()</code>is the JPA standard.</p>
<h2>4.4 Deleting objects</h2>
<p>If you want to delete an existing object, then it is very easy to do so. To do this, the session object has a special method - <code>remove()</code>.</p>
<p>The general form of such a request:</p>
<div class="lesson-example lesson-example--center">
 <pre class="lecture-code lecture-code--present  language-java" tabindex="0"><code class=" language-java"><span class="text-user">session</span><span class="token punctuation">.</span><span class="token function"><span class="text-red">remove</span></span><span class="token punctuation">(</span><span class="text-brown">An object</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<p>And, of course, let's write the code with an example:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword"></span><span class="text-brown"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">removeUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span></span><span class="token punctuation"></span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Session</span> <span class="text-user">session</span> <span class="token operator">=</span> <span class="text-yellow">sessionFactory</span><span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Transaction</span> transaction <span class="token operator">=</span> <span class="text-user">session</span><span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="text-user">session</span><span class="token punctuation">.</span><span class="token function"><span class="text-red">remove</span></span><span class="token punctuation">(</span><span class="text-brown">user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="text-viola">transaction</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Why is it so difficult, you ask?</p>
<p>Well, first of all, any changes to the database always have different and not always obvious consequences. And secondly, this object could have child objects associated with it, etc. So deletion scenarios are often non-trivial.</p>