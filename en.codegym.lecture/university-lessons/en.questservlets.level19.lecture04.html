Synchronizers: Synchronizing Access to Resources in Java
<p>----------------------------------------</p>
Semaphore CountDownLatch and others
<p>----------------------------------------</p>
ata-id="5b56b330-d15d-450e-9d26-15f951f2a98a" alt="" src="https://cdn.javarush.com/images/article/5b56b330-d15d-450e-9d26-15f951f2a98a/1024.jpeg" style="width: 1024px;">
<p>Semaphores are usually used when it is necessary to limit the number of threads when working with the file system. Access to a file or other shared resource is controlled through a counter. If its value is greater than zero, access is allowed, but at the same time the counter will decrease.</p>
<p>At the moment when the counter returns zero, the current thread will be blocked until the resource is released by another thread. The number of permissions parameter must be set via the constructor.</p>
<p>You need to select this parameter individually, depending on the power of your computer or laptop.</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>

   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">Semaphore</span> sem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">CommonResource</span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CommonResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> sem<span class="token punctuation">,</span> <span class="token string">"MyThread_1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> sem<span class="token punctuation">,</span> <span class="token string">"MyThread_2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> sem<span class="token punctuation">,</span> <span class="token string">"MyThread_3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">CommonResource</span> <span class="token punctuation">{</span>
   <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
   <span class="token class-name">CommonResource</span> commonResource<span class="token punctuation">;</span>
   <span class="token class-name">Semaphore</span> semaphore<span class="token punctuation">;</span>
   <span class="token class-name">String</span> name<span class="token punctuation">;</span>
   <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token class-name">CommonResource</span> commonResource<span class="token punctuation">,</span> <span class="token class-name">Semaphore</span> sem<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>commonResource <span class="token operator">=</span> commonResource<span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>semaphore <span class="token operator">=</span> sem<span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

       <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">"waiting permission"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           commonResource<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
           <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> commonResource<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
               commonResource<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
               <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">"releases permission"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2>CountDownLatch and others</h2>
<p><span class="code"><span class="text-green">CountDownLatch</span></span> - Allows multiple threads to wait until a certain number of operations performed on other threads have completed. An example is the installation of an application: it will not start until you accept the terms of use, until you select a folder where to install a new program, and so on. There is a special<span class="code text-orange"> countDown()</span> method for this - this method decrements the count down counter by one.</p>
<p>As soon as the count goes to zero, all waiting threads in the await will continue their work, and all subsequent calls of await will pass without waiting. The count down counter is a one-time counter and cannot be reset.</p>
<p><span class="code"><span class="text-green">CyclicBarrier</span></span> - used to synchronize a given number of threads at one point. The barrier is reached when N threads call the await(...) method and block. After that, the counter is reset to its original value, and the waiting threads will be released. Additionally, if needed, it is possible to run custom code before unblocking threads and resetting the counter. To do this, an object with an implementation of the<span class="text-neon"><span class="text-bold"><em> Runnable</em></span></span> interface is passed through the constructor .</p>
<p><span class="code"><span class="text-green">Exchanger&lt;V&gt;</span></span> — the<span class="code"><span class="text-green"> Exchanger</span></span> class is intended for data exchange between threads. It is typed and types the type of data that the threads need to exchange.</p>
<p>Data is exchanged using the only <span class="code text-orange">exchange()</span> method of this class :</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span><code class=" language-java"><span class="token class-name">V</span> <span class="token function">exchange</span><span class="token punctuation">(</span><span class="token class-name">V</span> x<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
<span class="token class-name">V</span> <span class="token function">exchange</span><span class="token punctuation">(</span><span class="token class-name">V</span> x<span class="token punctuation">,</span> <span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span></code></pre>
<p>The x parameter represents the data buffer to be exchanged. The second form of the method also defines the <span class="text-green">timeout</span> parameter , the timeout, and <span class="text-green">unit</span> , the type of time unit to use for the <span class="text-green">timeout</span> parameter .</p>
<p><span class="code"><span class="text-green">The Phaser</span></span> class allows you to synchronize threads that represent a single phase or stage in the execution of an overall action. <span class="code"><span class="text-green">Phaser</span></span> defines a synchronization object that waits until a certain phase has completed. <span class="code"><span class="text-green">The Phaser</span></span> then moves on to the next stage or phase and waits for it to complete again.</p>
<p>When working with the <span class="code"><span class="text-green">Phaser</span></span> class , it is common to first create its object. Next, we need to register all participants. To register for each participant, the <span class="code text-orange">register()</span> method is called , or you can do without this method by passing the required number of participants to the <span class="code"><span class="text-green">Phaser</span></span> constructor .</p>
<p>Then each participant performs a certain set of actions that make up the phase. And the <span class="code"><span class="text-green">Phaser</span></span> synchronizer waits until all participants have completed the execution of the phase. To inform the synchronizer that the phase has ended, the participant must call the <span class="code text-orange">arrive()</span> or <span class="code text-orange">arriveAndAwaitAdvance()</span> method . The synchronizer then moves on to the next phase.</p>