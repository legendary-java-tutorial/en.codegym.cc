Executor Services
<p>----------------------------------------</p>
Executive. ThreadPoolExecutor. Completion Service.
<p>----------------------------------------</p>
a-id="83e7f607-1195-4d00-a2b8-f790515dc1a9" alt="" src="https://cdn.javarush.com/images/article/83e7f607-1195-4d00-a2b8-f790515dc1a9/800.jpeg" style="width: 800px;">
<p><span class="text-neon"><span class="text-bold"><em>Executor</em></span></span> is the base interface for classes that implements the launch of<span class="text-neon"><span class="text-bold"><em> Runnable</em></span></span> tasks. This provides assistance with adding a task and how to start it.</p>
<p><span class="text-neon"><span class="text-bold"><em>ExecutorService</em></span></span> is an interface that extends the properties<span class="text-neon"><span class="text-bold"><em> of Executor</em></span></span> and which describes a service for running<span class="text-neon"><span class="text-bold"><em> Runnable</em></span></span> or<span class="text-neon"><span class="text-bold"><em> Callable</em></span></span> tasks. The submit methods accept a task in the form of<span class="text-neon"><span class="text-bold"><em> a Callable</em></span></span> or<span class="text-neon"><span class="text-bold"><em> Runnable</em></span></span> as an input , and a Future is used as a return value, through which you can get the result.</p>
<p><span class="code text-orange">The invokeAll</span> method is responsible for executing tasks, returning a list of tasks with their status and completion results.</p>
<p><span class="code text-orange">The invokeAny</span> method is responsible for executing tasks, returning the result of a successfully completed task (that is, without throwing an exception), if any.</p>
<p><span class="text-neon"><span class="text-bold"><em>ScheduledExecutorService</em></span></span> - this interface adds the ability to run pending tasks with a certain delay or a certain period.</p>
<p><span class="code"><span class="text-green">AbstractExecutorService</span></span> is an abstract class for constructing<span class="text-neon"><span class="text-bold"><em> an ExecutorService</em></span></span> 'a. Inside there is an implementation of<span class="code text-orange"> the submit</span> ,<span class="code text-orange"> invokeAll</span> ,<span class="code text-orange"> invokeAny</span> methods . This class inherits<span class="text-green"><span class="text-bold"><em> ThreadPoolExecutor</em></span></span> ,<span class="text-green"><span class="text-bold"><em> ScheduledThreadPoolExecutor</em></span></span> and<span class="text-green"><span class="text-bold"><em> ForkJoinPool</em></span></span> .</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">ScheduledExecutorService</span> scheduledExecutorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newScheduledThreadPool</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> task <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
   scheduledExecutorService<span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
   scheduledExecutorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h2>ThreadPoolExecutor</h2><img data-max-width="800" data-id="2b86fe3b-e258-4219-8c32-7d3ba93670ea" alt="" src="https://cdn.javarush.com/images/article/2b86fe3b-e258-4219-8c32-7d3ba93670ea/800.jpeg" style="width: 800px;">
<p><span class="code"><span class="text-green">Executors</span></span> is a factory class for creating<span class="text-green"><span class="text-bold"><em> ThreadPoolExecutor</em></span></span> ,<span class="text-green"><span class="text-bold"><em> ScheduledThreadPoolExecutor</em></span></span> . If you need to create one of these pools, then this factory is exactly what you need. It contains different adapters Runnable-Callable, PrivilegedAction-Callable, PrivilegedExceptionAction-Callable and others. Has static methods for creating different<span class="text-green"><span class="text-bold"><em> ThreadPool</em></span></span> .</p>
<p><span class="text-green"><span class="text-bold"><em>ThreadPoolExecutor</em></span></span> - Implements<span class="text-neon"><span class="text-bold"><em> the Executor</em></span></span> and<span class="text-neon"><span class="text-bold"><em> ExecutorService</em></span></span> interfaces and separates task creation from task execution. We need to implement<span class="text-neon"><span class="text-bold"><em> Runnable</em></span></span> objects and send them to the executor, and<span class="text-green"><span class="text-bold"><em> ThreadPoolExecutor</em></span></span> is responsible for their execution, instantiation and work with threads.</p>
<p><span class="text-green"><span class="text-bold"><em>ScheduledThreadPoolExecutor</em></span></span> - In addition to the<span class="text-green"><span class="text-bold"><em> ThreadPoolExecutor</em></span></span> methods , it creates a pool of threads that can schedule commands to execute after a given delay or for periodic execution.</p>
<p><mark class="green">ThreadFactory</mark>is an object that creates new threads on demand. We need to pass an instance to the <span class="code text-orange">Executors.newSingleThreadExecutor(ThreadFactory threadFactory)</span> method .</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">Thread</span> <span class="token function">newThread</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token string">"MyThread"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread<span class="token punctuation">.</span><span class="token function">setPriority</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span>MAX_PRIORITY<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> thread<span class="token punctuation">;</span> <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><span class="text-neon"><span class="text-bold"><em>RejectedExecutionHandler</em></span></span> - allows you to define a handler for tasks that for some reason cannot be executed through<span class="text-green"><span class="text-bold"><em> the ThreadPoolExecutor</em></span></span> . This happens when there are no free streams or the service is shut down or shutdown.</p>
<p>Several standard implementations are found in the <span class="code"><span class="text-green">ThreadPoolExecutor</span></span> class :</p>
<ul>
 <li>CallerRunsPolicy - runs a task on the calling thread;</li>
 <li>AbortPolicy - throws an exception;</li>
 <li>DiscardPolicy - ignores the task;</li>
 <li>DiscardOldestPolicy - Removes the oldest unstarted task from the queue, then tries to add a new task again.</li>
</ul>
<h2>Completion Service</h2><img data-max-width="512" data-id="52be544f-17a5-406c-9f5f-9864056f87a8" alt="" src="https://cdn.javarush.com/images/article/52be544f-17a5-406c-9f5f-9864056f87a8/512.jpeg" style="width: 512px;">
<p><span class="text-neon"><span class="text-bold"><em>CompletionService</em></span></span> is a service interface with decoupling of launching asynchronous tasks and getting results. <span class="code text-orange">To add tasks, there is a submit</span>method, and to get the results of already completed tasks, a blocking<span class="code text-orange">take</span>and a non-blocking<span class="code text-orange">poll</span>.</p>
<p><span class="code"><span class="text-green">ExecutorCompletionService</span></span> is a wrapper over any class that implements<span class="text-neon"><span class="text-bold"><em> the Executor</em></span></span> interface , such as<span class="text-green"><span class="text-bold"><em> ThreadPoolExecutor</em></span></span> or<span class="text-green"><span class="text-bold"><em> ForkJoinPool</em></span></span> . It is used when it is necessary to abstract from the method of launching tasks and controlling their execution.</p>
<p>If there are completed tasks, then we pull them out. If there are no tasks, then we hang in take until something is completed. The service uses a LinkedBlockingQueue at its core, but you can pass in any BlockingQueue implementation.</p>