Useful annotations in JUnit
<p>----------------------------------------</p>
@Disabled @Nested @TestInstance @ExtendWith @Timeout
<p>----------------------------------------</p>
<h2>4.1 @Disabled</h2>
<p>Let's look at some very useful and popular annotations of the JUnit framework. The first annotation allows you to turn off a specific test so that JUnit does not call it. It is needed in cases where you notice that the test is not working correctly, or you change the code and the test accidentally breaks.</p>
<p>As I wrote earlier, 99% of the tests are not supported by anyone, so they all turn out to be disabled sooner or later. Therefore, this annotation is the first in the list of useful ones.</p>
<p>Consider her example:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation"></span><span class="text-green"><span class="token annotation punctuation">@Disabled</span><span class="token punctuation">(</span><span class="token string">"Test is temporarily disabled. True, true"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Test</span></span><span class="token annotation punctuation"></span>
    <span class="token keyword">void</span> <span class="token function">testOnDev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">,</span> <span class="token string">"DEV"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assumptions</span><span class="token punctuation">.</span><span class="token function">assumeFalse</span><span class="token punctuation">(</span><span class="token string">"DEV"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation"><span class="text-green">@Test</span></span>
    <span class="token keyword">void</span> <span class="token function">testOnProd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">,</span> <span class="token string">"PROD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assumptions</span><span class="token punctuation">.</span><span class="token function">assumeFalse</span><span class="token punctuation">(</span><span class="token string">"DEV"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>In the example above, the method <code>testOnDev()</code>will not be called. By the way, the annotation <code>@Disabled</code>can be written immediately before the class declaration, then all its methods will be ignored.</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation"></span><span class="text-green"><span class="token annotation punctuation">@Disabled</span><span class="token punctuation">(</span><span class="token string">"Temporarily turned off the test, we will fix it by May 2001"</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation"><span class="text-green">@Test</span></span>
    <span class="token keyword">void</span> <span class="token function">testOnDev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">,</span> <span class="token string">"DEV"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assumptions</span><span class="token punctuation">.</span><span class="token function">assumeFalse</span><span class="token punctuation">(</span><span class="token string">"DEV"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation"><span class="text-green">@Test</span></span>
    <span class="token keyword">void</span> <span class="token function">testOnProd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">,</span> <span class="token string">"PROD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assumptions</span><span class="token punctuation">.</span><span class="token function">assumeFalse</span><span class="token punctuation">(</span><span class="token string">"DEV"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2>4.2 @Nested</h2>
<p>JUnit allows you to call test methods on nested classes. I mean nested test classes. It is not a fact that you will often encounter them, but there is such a possibility, so you need to understand what it is.</p>
<p>To call the methods of a nested class before its declaration, you need to write an annotation <code>@Nested</code>. Example:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppTest</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation"><span class="text-green">@Nested</span></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DevStagingEnvironment</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation"><span class="text-green">@Test</span></span>
        <span class="token keyword">void</span> <span class="token function">testOnDev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">,</span> <span class="token string">"DEV"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Assumptions</span><span class="token punctuation">.</span><span class="token function">assumeFalse</span><span class="token punctuation">(</span><span class="token string">"DEV"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

    <span class="token annotation punctuation"><span class="text-green">@Nested</span></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductionEnvironment</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation"><span class="text-green">@Test</span></span>
        <span class="token keyword">void</span> <span class="token function">testOnProd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">setProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">,</span> <span class="token string">"PROD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token class-name">Assumptions</span><span class="token punctuation">.</span><span class="token function">assumeFalse</span><span class="token punctuation">(</span><span class="token string">"DEV"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"ENV"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>More details can be found in the official <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-nested" target="_blank">documentation</a> .</p>
<h2>4.3 @ExtendWith</h2>
<p>Another useful annotation is <code>@ExtendWith</code>. Most likely you will meet her very often, so let's look at her in more detail.</p>
<p>JUnit is a powerful framework that allows you to write various plugins (extensions) for flexible customization of your work. Some extensions can collect statistics about tests, others can emulate an in-memory file system, others can emulate working inside a web server, and so on.</p>
<p>If your code is running inside a framework (for example, Spring), <span class="text-user">then almost always this framework manages the creation and configuration of objects in your code</span> . Therefore, a special test plugin is indispensable. Examples:</p>
<p><strong>Example 1.</strong> The extension <code>WebServerExtension</code>passes to the called test method <code>URL</code>in order to work correctly.</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation"></span><span class="text-green"><span class="token annotation punctuation">@Test</span>
<span class="token annotation punctuation">@ExtendWith</span><span class="token punctuation">(</span><span class="token class-name">WebServerExtension</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
<span class="token keyword">void</span> <span class="token function">getProductList</span><span class="token punctuation">(</span><span class="token annotation punctuation"><span class="text-green">@WebServerUrl</span></span> <span class="token class-name">String</span> serverUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">WebClient</span> webClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Use WebClient to connect to web server using serverUrl and verify response</span>
    <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>serverUrl <span class="token operator">+</span> <span class="token string">"/products"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResponseStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>This is how tests usually start to test code that works with the Spring framework:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation"></span><span class="text-red"><span class="token annotation punctuation">@ExtendWith</span><span class="token punctuation">(</span><span class="token class-name">SpringExtension</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
<span class="token annotation punctuation"></span><span class="text-red"><span class="token annotation punctuation">@ExtendWith</span><span class="token punctuation">(</span><span class="token class-name">MockitoExtension</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span></span><span class="token punctuation"></span>
<span class="token keyword">class</span> <span class="token class-name">TestServiceTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@MockBean</span>
    <span class="token class-name">TestService</span> service<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">assertNotNull</span><span class="token punctuation">(</span>service<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Test succeeds</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><code class="text-red">SpringExtension</code>creates a test version of the Spring framework, but <code class="text-red">MockitoExtention</code>allows you to create fake objects. Fake objects is a very interesting topic, we will definitely touch on it, but a little later.</p>
<h2>4.4 @Timeout</h2>
<p>Let's finish this lecture with a small and interesting annotation <code>@Timeout</code>. It allows you to set the time to run the test. If the test took more time than specified in the annotation, then it is considered failed.</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">class</span> <span class="token class-name">TimeoutDemo</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation"></span><span class="text-green"><span class="token annotation punctuation">@Test</span>
    <span class="token annotation punctuation">@Timeout</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> unit <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span></span><span class="token punctuation"></span>
    <span class="token keyword">void</span> <span class="token function">failsIfExecutionTimeExceeds100Milliseconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// test will fail if it takes more than 100 milliseconds</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>This concludes our lecture.</p>