Related project: Hibernate (2)
<p>----------------------------------------</p>
Related project: Hibernate (2)
<p>----------------------------------------</p>
<h3>Today our task is to complete the second project on the Hibernate topic. Its essence is to understand the structure of the database, map the entity to existing tables, and add the minimum functionality to check that the mapping is done correctly.</h3>
<p><strong>Now in more detail:</strong></p>
<ol>
 <li><a href="https://codegym.cc/downloads/ide/codegym/dump-hibernate-2.sql" target="_blank">Download the dump file</a> and deploy it to your local machine. As a database, we will use a test database, which is distributed as an example along with the MySQL installation package. The dump is needed in order to fix the state of the database, since we cannot guarantee that it will not change in a day, month, year.</li>
 <li>We will not have a project template, so create the project yourself. It should be a maven project with all required dependencies ( <strong>hibernate-core-jakarta</strong> , <strong>mysql-connector-java</strong> , <strong>p6spy</strong> ).</li>
 <li>Plug in our local deployed database as a datasource in Idea. After that, in the Database tab, put the cursor on the movie schema and press the key combination <code>Alt+Ctrl+Shift+U</code>(only works in the Ultimate version). This will show the structure of the entire movie schema (with column names, keys, etc.). Looks like this: <img data-max-width="1024" data-id="2b71a9bb-4d0b-4693-81fb-b1119978a0e3" alt="" src="https://cdn.javarush.com/images/article/2b71a9bb-4d0b-4693-81fb-b1119978a0e3/1024.jpeg" style="width: 1024px;">
  <p>I agree, it's not very comfortable to watch. Turn off the display of the title of all columns and comments:</p><img data-max-width="512" data-id="24c31d79-1015-41a8-90d4-5c4e0a3513c3" alt="" src="https://cdn.javarush.com/images/article/24c31d79-1015-41a8-90d4-5c4e0a3513c3/512.jpeg" style="width: 512px;">
  <p>As a result, you will get a database schema that can already be analyzed:</p><img data-max-width="1024" data-id="85a773a5-42a9-4cb9-b885-f05e859df442" alt="" src="https://cdn.javarush.com/images/article/85a773a5-42a9-4cb9-b885-f05e859df442/1024.jpeg" style="width: 1024px;"></li>
 <li>The circuit looks complicated, but not everything is so bad. To analyze the structure of the database, you need to find where to start. There is no single correct answer, but I would recommend starting with a table <code>film</code>. Let's take a few relationships as an example: 
  <ul>
   <li>The relationship between tables <code>film</code>and <code>film_text</code>is an explicit <strong>OneToOne</strong> relationship , because the table <code>film_text</code>has a field <code>film_id</code>that<mark class="red">NOT</mark>refers to <strong>an ID</strong> from a table <code>film</code>(no foreign key). But by name and logic, this connection should be. In addition, in the table, <code>film_text</code>the field <code>film_id</code>acts as a primary key, which guarantees that one "movie" corresponds to no more than one "film text".</li>
   <li>Now let's look at tables <code>film</code>and <code>category</code>. Logically, a movie can have several categories. And one category, maybe different films. In addition, there is an intermediate link table between these two tables <code>film_category</code>. Based on all of the above, this is an explicit <strong>ManyToMany</strong> relationship .</li>
   <li>We look at the tables <code>film</code>and <code>language</code>. From the point of view of logic, the film may have a translation into different languages ​​and different films may be in the same language. That is, <strong>ManyToMany</strong> suggests itself . But if we look at the contents of the table <code>film</code>, we can see that each row of the table is a unique movie. And there is only one <strong>language_id</strong> field in the line (there is also original_language_id, but in all records it is null, so we can ignore it). That is, one film can have only one language. And one language, maybe different films. The connection is <strong>ManyToOne</strong> (the connection is directed from film to language).</li>
  </ul></li>
 <li>Now the main task is to create all the necessary entity classes and map them onto the schema tables <code>movie</code>.</li>
 <li>Add a method that can create a new customer (customer table) with all dependent fields. Do not forget to make the method transactional (so as not to get into the situation that the address of the buyer is recorded in the database, but the buyer himself is not).</li>
 <li>Add a transactional method that describes the "customer went and returned a previously rented movie" event. Choose any buyer and rental event of your choice. The rating of the film does not need to be recalculated.</li>
 <li>Add a transactional method that describes the event “the buyer went to the store (store) and rented (rental) inventory (inventory) there. At the same time, he made a payment (payment) to the seller (staff). Film (through inventory) choose at your discretion. The only restriction is that the film must be available for rent. That is, either there should be no inventory records in rental at all, or the <strong>return_date</strong> column of the table <code>rental</code>for the last rental of this inventory should be filled.</li>
 <li>Add a transactional method that describes the event "a new movie was shot and it became available for rent." Film, language, actors, categories, etc., choose at your discretion.</li>
 <li>The table structure cannot be changed. But you need to make suggestions for improvement. We identified one problematic place in paragraph 4 (absence of <strong>foreign key</strong> in the table <code>film_text</code>on the <code>film_id</code>table field <code>film</code>). See if there are still such “blunders” in the database structure. If so, add a readme file to the root of the project and describe these blunders.</li>
</ol>
<hr>
<p>Project analysis:</p>
<ul>
 <li><a href="https://youtu.be/QIdL2bZI4jY" target="_blank" rel="nofollow">Part 1</a></li>
 <li><a href="https://youtu.be/vKxB8S43otI" target="_blank" rel="nofollow">Part 2</a></li>
 <li><a href="https://youtu.be/QvfmO82iV98" target="_blank" rel="nofollow">Part 3</a></li>
</ul>