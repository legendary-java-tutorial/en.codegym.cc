How to save an object in Hibernate
<p>----------------------------------------</p>
Possible options for the status of the object. The nuances of the persist() methods. The nuances of the save() method.
<p>----------------------------------------</p>
<h2>Possible object status options</h2>
<p>As you may have noticed, when an object is attached to Hibernate, its state is called <strong>Persistent</strong> or <strong>Managed</strong> . How right? Persist or Managed?</p>
<p>It is possible and so, and so. According to the JPA specification, an object has a Persist state, and according to the Hibernate specification, its state is called Managed.</p>
<p>In Hibernate, work with the database is carried out through an object of type <strong>org.hibernate.Session</strong> . According to JPA, the class should be called javax.persistence.EntityManager. This isn't really a big problem, since both types are interfaces.</p>
<p><span class="text-neon"><span class="text-bold"><em>The org.hibernate.Session</em></span></span> interface is declared like this:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java"><span class="token keyword">interface</span> <span class="token class-name">Session</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>AutoCloseable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span>EntityManager</span><span class="token punctuation">,</span> <span class="token class-name">HibernateEntityManager</span><span class="token punctuation">,</span>    <span class="token class-name">QueryProducer</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span><span class="token punctuation">,</span> <span class="token class-name">SharedSessionContract</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span></code></pre>
<p><span class="text-neon"><span class="text-bold"><em>Therefore, the Session</em></span></span> interface has all the methods that are in the <span class="text-neon"><span class="text-bold"><em>EntityManager</em></span></span> interface . But it also has its own, which it inherited from earlier versions of Hibernate, when there was no JPA specification yet.</p>
<p>This whole situation is described as follows:</p><img data-max-width="1024" data-id="cf37099a-e8cc-4f2b-a7c9-8d53c3159875" alt="" src="https://cdn.javarush.com/images/article/cf37099a-e8cc-4f2b-a7c9-8d53c3159875/1024.jpeg" style="width: 1024px;">
<p>Let's take a look at all the methods that the session interface has, as well as the nuances of their work.</p>
<h2>The nuances of the persist() method</h2>
<p>When saving an object to the database, you need to remember two things.</p>
<p>First, saving the object will eventually result in the execution of one of the SQL commands: INSERT or UPDATE. Secondly, these actions will not occur immediately after calling the object's method<mark class="green">session</mark>, but only after closing the transaction.</p>
<p>Let's consider some simple situation, for example, you have a <span class="code"><span class="text-green">User</span></span> class :</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Id</span>
	<span class="token annotation punctuation">@GeneratedValue</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Columnt</span><span class="token punctuation">(</span>name<span class="token operator">=</span>”user_name”<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Let's save its object to the database using the <span class="code text-orange">persist()</span> method .</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Kolyan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
session<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The purpose of this method is to save a new object to the database. If there is no such object yet, then it will be added to the database by calling the <strong>INSERT</strong> SQL method .</p>
<p>If the object is already in the database, then nothing will happen. However, a third case is also possible - an attempt to save an object with the Detached status to the database. In this case, an exception will be thrown. Example:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Kolyan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
session<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

session<span class="token punctuation">.</span><span class="token function">evict</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// detach the object from the session</span>
session<span class="token punctuation">.</span><span class="token function">persist</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a PersistenceException will be thrown here!</span></code></pre>
<h2>The nuances of the save() method</h2>
<p>The save() method was inherited by the current Hibernate from its previous versions. At its core, it is very similar to the <span class="code text-orange">persist()</span> method , it also adds a new record to the table using the INSERT method. However, it has several interesting nuances.</p>
<p>First, this method <strong>returns a value - the new ID of the object</strong> . As you already know, objects usually do not have an ID before being added to the database and it is already assigned by the database. So, the <span class="code text-orange">save()</span> method of the session object returns the ID that was assigned to the saved object.</p>
<p><strong>Important! </strong>According to the Hibernate ID specification, it can be any serializable object, not just a number. It can be a string, a number, an enum, anything in general that can be put entirely in one column of a table in the database.</p>
<p><span class="code text-orange">The save()</span> method has a Serialized result type, so its result must be cast to the correct type:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Kolyan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Integer</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Also, the <span class="code text-orange">save()</span> method has a different behavior in the case of the object's Detached state. It considers such an object as new and simply adds another entry:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Kolyan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Integer</span> id <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

session<span class="token punctuation">.</span><span class="token function">evict</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> 	<span class="token comment">// detach the object from the session</span>
<span class="token class-name">Integer</span> id2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>The id and id2 variables will be different. Two records will be added to the table in the database, one for each <span class="code text-orange">save()</span> operation .</p>