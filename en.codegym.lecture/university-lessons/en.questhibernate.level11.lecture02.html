How to change an object in Hibernate
<p>----------------------------------------</p>
The nuances of the merge() method. The nuances of the update() method. saveOrUpdate() method.
<p>----------------------------------------</p>
>If you want to use Hibernate to change an object that has already been stored in the database, then there are also several methods for this.</p>
<p>The first is the <span class="code text-orange">merge()</span> method , <span class="text-green">which updates the information in the database based on the passed object</span> . This will invoke the SQL UPDATE query. Example:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Kolyan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
session<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

session<span class="token punctuation">.</span><span class="token function">evict</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// detach the object from the session</span>
user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Masha"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">User</span> user2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>There are several important nuances here.</p>
<p>First, the <span class="code text-orange">merge()</span> method returns the result, the updated object. This object has a Persist state and is attached to the session object. The object passed to the <span class="code text-orange">merge()</span> method does not change.</p>
<p>It may seem that there is no difference between user and user2, but it is not. <span class="code text-orange">You can pass a POJO object to the merge()</span> method , and as a result, the method can return a proxy (depending on the Hibernate settings). So just remember that the <span class="text-red"><span class="code text-orange">merge()</span></span><span class="text-red"> method does not change the passed object.<span class="code text-orange"></span></span></p>
<p>Secondly, if the object passed to <span class="code text-orange">merge()</span> has the Transient status (and it does not have an ID), then a separate line will be created for it in the database. <span class="code text-orange">In other words, the persist()</span> command will be executed .</p>
<p>Thirdly, if an object already attached to the session (with the Persist status) is passed to the <span class="code text-orange">merge() method, then nothing will happen - the method will simply return the same object. </span>Why? And all because when the transaction is committed, the data will be written to the database anyway:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Kolyan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
session<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Masha"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//change the object attached to the session</span>

session<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//all changed objects will be written to the database</span></code></pre>
<p>There is no need to save the object every time after any of its changes. If this object is in Persist status, then Hibernate will do everything itself. If you change an object that is “attached to the base”, then all its changes will be written to the base.</p>
<h2>The nuances of the update() method</h2>
<p>Hibernate also has an <span class="code text-orange">update()</span> method , which, like the <span class="code text-orange">save()</span> method , was inherited from previous versions. With this method, you can only update the data of an already saved object. This will invoke the SQL UPDATE query. Example:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Kolyan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
session<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

session<span class="token punctuation">.</span><span class="token function">evict</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// detach the object from the session</span>
user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Masha"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

session<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This method does not return anything and does not change the existing object.</p>
<p>If you call this method on a new object, then an exception will simply be thrown:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Kolyan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
session<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//an exception will be thrown here</span></code></pre>
<h2>saveOrUpdate() Method</h2>
<p>Before the advent of JPA, the function of the <span class="code text-orange">persist() method was performed by </span><span class="code text-orange">the saveOrUpdate()</span> method . His task was to update the information on the existing object in the database, and if there is none, then create it. It is almost always used in place of <span class="code text-orange">the save()</span> and <span class="code text-orange">update()</span> methods .</p>
<p>Unlike the <span class="code text-orange">update()</span> method , it can change the object passed to it. For example, set it to the ID that was assigned when saving to the database. Example:</p>
<pre class=" line-numbers language-java" tabindex="0"><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span><code class=" language-java"><span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"Kolyan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
session<span class="token punctuation">.</span><span class="token function">saveOrUpdate</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//object will be written to the database</span></code></pre>
<p>How it works:</p>
<ul>
 <li>if the passed object has an ID, then the UPDATE SQL method is called</li>
 <li>if the ID of the passed object is not set, then the INSERT SQL method is called</li>
</ul>
